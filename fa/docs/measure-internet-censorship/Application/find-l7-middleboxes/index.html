<!doctype html><html lang=fa-ir dir=rtl><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="چگونه اثرانگشت سیستم سانسور را در ترافیک خود شناسایی کنیم و همینطور موقعیت سیستم سانسور کننده در لایه ی کاربرد را در مسیر شبکه مشخص کنیم."><meta name=theme-color content="#FFFFFF"><meta name=color-scheme content="light dark"><meta property="og:title" content="یافتن سیستم سانسور کننده در لایه ی کاربرد"><meta property="og:description" content="چگونه اثرانگشت سیستم سانسور را در ترافیک خود شناسایی کنیم و همینطور موقعیت سیستم سانسور کننده در لایه ی کاربرد را در مسیر شبکه مشخص کنیم."><meta property="og:type" content="website"><meta property="og:url" content="https://wikicensorship.github.io/fa/docs/measure-internet-censorship/Application/find-l7-middleboxes/"><meta property="og:image" content="https://wikicensorship.github.io/images/docs/measure-internet-censorship/Application/find-l7-middleboxes/tracevis-clubhouse-client-hello-blocking-mci.png"><meta property="og:updated_time" content="2022-06-29T00:00:00+00:00"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://wikicensorship.github.io/images/docs/measure-internet-censorship/Application/find-l7-middleboxes/tracevis-clubhouse-client-hello-blocking-mci.png"><meta name=twitter:title content="یافتن سیستم سانسور کننده در لایه ی کاربرد"><meta name=twitter:description content="چگونه اثرانگشت سیستم سانسور را در ترافیک خود شناسایی کنیم و همینطور موقعیت سیستم سانسور کننده در لایه ی کاربرد را در مسیر شبکه مشخص کنیم."><title>یافتن سیستم سانسور کننده در لایه ی کاربرد | ویکی سانسور</title><link rel=manifest href=/manifest.json><link rel=icon href=/favicon.ico type=image/x-icon><link rel=stylesheet href=/book.min.6753c9a2e1d2c7db2692372006c6018c08756535c90fbae9b20bd0c9cede1a0c.css integrity="sha256-Z1PJouHSx9smkjcgBsYBjAh1ZTXJD7rpsgvQyc7eGgw=" crossorigin=anonymous><script defer src=/flexsearch.min.js></script>
<script defer src=/fa.search.min.9401729b21ec3e06e0d4160cc65d58a844bbae896d791e7d2110ce5fcc631b9d.js integrity="sha256-lAFymyHsPgbg1BYMxl1YqES7rolteR59IRDOX8xjG50=" crossorigin=anonymous></script>
<script defer src=/sw.min.6f6f90fcb8eb1c49ec389838e6b801d0de19430b8e516902f8d75c3c8bd98739.js integrity="sha256-b2+Q/LjrHEnsOJg45rgB0N4ZQwuOUWkC+NdcPIvZhzk=" crossorigin=anonymous></script>
<link rel=alternate type=application/rss+xml href=https://wikicensorship.github.io/fa/docs/measure-internet-censorship/Application/find-l7-middleboxes/index.xml title="ویکی سانسور"><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#da532c"></head><body dir=rtl><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><div class=book-menu-content><nav><h2 class=book-brand><a class="flex align-center" href=/fa/><img src=/logo.png alt=Logo><span>ویکی سانسور</span></a></h2><div><a href=https://github.com/wikicensorship/wikicensorship.github.io target=_blank class=btn-with-count><svg aria-hidden="true" height="16" viewBox="0 0 16 16" width="16" data-view-component="true" class="octicon-star"><path fill-rule="evenodd" d="M8 .25a.75.75.0 01.673.418l1.882 3.815 4.21.612a.75.75.0 01.416 1.279l-3.046 2.97.719 4.192a.75.75.0 01-1.088.791L8 12.347l-3.766 1.98a.75.75.0 01-1.088-.79l.72-4.194L.818 6.374a.75.75.0 01.416-1.28l4.21-.611L7.327.668A.75.75.0 018 .25zm0 2.445L6.615 5.5a.75.75.0 01-.564.41l-3.097.45 2.24 2.184a.75.75.0 01.216.664l-.528 3.084 2.769-1.456a.75.75.0 01.698.0l2.77 1.456-.53-3.084a.75.75.0 01.216-.664l2.24-2.183-3.096-.45a.75.75.0 01-.564-.41L8 2.694v.001z"/></svg><span class=social-count data-view-component=true></span></a>
<span>&nbsp;</span>
<span id=moon onclick=toggletheme()>&#127763;</span></div><div><div class=book-search><input type=text id=book-search-input placeholder=جستجو aria-label=جستجو maxlength=64 data-hotkeys><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><ul><li class=book-section-flat><a href=/fa/docs/measure-internet-censorship/>بررسی سانسور اینترنت: مقدمه</a><ul><li class=book-section-flat><a href=/fa/docs/measure-internet-censorship/OONI/>بررسی سانسور اینترنت از طریق کاوشگر OONI</a><ul></ul></li><li><input type=checkbox id=section-b27922a206ba3ea02b04ee458849072c class=toggle>
<label for=section-b27922a206ba3ea02b04ee458849072c class="flex justify-between"><a href=/fa/docs/measure-internet-censorship/DNS/>بررسی سانسور اینترنت در ارتباط DNS</a></label><ul><li><a href=/fa/docs/measure-internet-censorship/DNS/find-DNS-hijacker/>یافتن دستگاه سانسور کننده ی DNS</a><ul></ul></li></ul></li><li class=book-section-flat><a href=/fa/docs/measure-internet-censorship/Network/>بررسی سانسور در ارتباط با سرور در لایه‌ی شبکه و انتقال</a><ul></ul></li><li><input type=checkbox id=section-92e03b3737d103b4c448d4ee6bf80921 class=toggle checked>
<label for=section-92e03b3737d103b4c448d4ee6bf80921 class="flex justify-between"><a href=/fa/docs/measure-internet-censorship/Application/>بررسی سانسور در ارتباط با سرور در لایه‌ی کاربرد</a></label><ul><li><a href=/fa/docs/measure-internet-censorship/Application/find-l7-middleboxes/ class=active>یافتن سیستم سانسور کننده در لایه ی کاربرد</a><ul></ul></li></ul></li></ul></li></ul><ul><li><a href=/fa/glossary/>فرهنگ لغات فنی</a></li><li><a href=/fa/posts/>بلاگ</a></li><li><a href=https://github.com/wikicensorship target=_blank rel=noopener>GitHub</a></li></ul></nav><script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script><div class=book-languages tabindex=0 aria-haspopup=true><ul><li class="flex align-center"><img src=/svg/translate.svg class=book-icon alt=Languages>
Languages</li></ul><ul class=book-languages-list><li class=active><a href=https://wikicensorship.github.io/fa/ class="flex align-center"><img src=/svg/translate.svg class=book-icon alt=Languages>
فارسی</a></li><li><a href=https://wikicensorship.github.io/ class="flex align-center"><img src=/svg/translate.svg class=book-icon alt=Languages>
English</a></li><li><a href=https://wikicensorship.github.io/ru/ class="flex align-center"><img src=/svg/translate.svg class=book-icon alt=Languages>
Русский</a></li></ul></div></div></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/svg/menu.svg class=book-icon alt=Menu></label>
<strong>یافتن سیستم سانسور کننده در لایه ی کاربرد</strong>
<label for=toc-control><img src=/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav id=TableOfContents><ul><li><a href=#یافتن-سیستم-سانسور-کننده-در-لایه-ی-کاربرد>یافتن سیستم سانسور کننده در لایه ی کاربرد</a><ul><li><a href=#یافتن-fingerprint-سیستم-سانسور-در-پاسخ-ها>یافتن fingerprint سیستم سانسور در پاسخ ها</a><ul><li><a href=#شناسایی-از-طریق-ipid>شناسایی از طریق IP.ID</a></li><li><a href=#انجام-application-traceroute>انجام application traceroute</a></li></ul></li><li><a href=#شناسایی-موقعیت-سیستم-های-سانسور-دیگر-در-یک-مسیر-یکسان>شناسایی موقعیت سیستم های سانسور دیگر در یک مسیر یکسان</a><ul><li><a href=#سیستم-سانسور-tls-fingerprint>سیستم سانسور TLS fingerprint</a></li><li><a href=#سانسورهای-امنیتی>سانسورهای امنیتی</a></li></ul></li></ul></li></ul></nav></aside></header><article class=markdown ondblclick='this.setAttribute("contenteditable","true")'><h1 id=یافتن-سیستم-سانسور-کننده-در-لایه-ی-کاربرد>یافتن سیستم سانسور کننده در لایه ی کاربرد
<a class=anchor href=#%db%8c%d8%a7%d9%81%d8%aa%d9%86-%d8%b3%db%8c%d8%b3%d8%aa%d9%85-%d8%b3%d8%a7%d9%86%d8%b3%d9%88%d8%b1-%da%a9%d9%86%d9%86%d8%af%d9%87-%d8%af%d8%b1-%d9%84%d8%a7%db%8c%d9%87-%db%8c-%da%a9%d8%a7%d8%b1%d8%a8%d8%b1%d8%af>#</a></h1><p>در بخش «
<a href=/fa/docs/measure-internet-censorship/Application/>بررسی سانسور در ارتباط در لایه ی کاربرد</a>» در مورد روش های مقدماتی شناسایی سانسور در این لایه صحبت شد، اما همیشه سانسور به این سادگی قابل شناسایی نیست.
مخصوصا زمانی که خود پروتکل هایی مانند TLS، HTTP و یا SSH در IP مورد هدف قرار گرفته شده باشد، نه مقدار hostname یا چیزی دیگر درون این packet ها.</p><p>رفتار ها:</p><ul><li>خطای timeout به سمت یک IP ی مشخص بعد از ارسال TCP یا UDP ی دارای payload</li><li>فقط drop شدن یکسری packet های خاص، مانند Server Hello و FIN و پاسخ با ACK</li><li>قطع شدن ارتباط بعد از مدتی. مانند SSH بعد از حدود 15 تا 60 ثانیه</li></ul><p>در این حالت، انجام trace route های سنتی به تنهایی، بی معنی است و به چیزی نخواهید رسید.
چرا که این نوع سانسورها بعد از TCP handshake و یا با تاخیر رخ می دهند.
برای بررسی درست، دو راه دارید:</p><ul><li>یافتن fingerprint سیستم سانسور در پاسخ ها</li><li>انجام application traceroute</li></ul><p>در ادامه این موارد را توضیح می دهیم و بعد در مورد شناسایی موقعیت سیستم های سانسور در مسیر ارتباط را بیشتر توضیح می دهیم.
مانند انسداد متناوب اینستاگرام و مسدود کردن کروم به سمت آمازون از طریق TLS fingerprint.
همچنین به سانسورهای امنیتی سایت های میزبانی شده در داخل و خارج، همانند کلاب‌هاوس اشاره می کنیم.</p><h2 id=یافتن-fingerprint-سیستم-سانسور-در-پاسخ-ها>یافتن fingerprint سیستم سانسور در پاسخ ها
<a class=anchor href=#%db%8c%d8%a7%d9%81%d8%aa%d9%86-fingerprint-%d8%b3%db%8c%d8%b3%d8%aa%d9%85-%d8%b3%d8%a7%d9%86%d8%b3%d9%88%d8%b1-%d8%af%d8%b1-%d9%be%d8%a7%d8%b3%d8%ae-%d9%87%d8%a7>#</a></h2><p>تمام middlebox ها به دلیل اینکه سعی در جعل هویت سرور را دارند تا توسط برنامه ها در client مورد پذیرش قرار بگیرند، خصوصیاتی دارند که در حالی که حتی random به نظر می رسند، از الگوی مشخص پیروی میکنند که میتوان آنرا اثر انگشت سیستم سانسور کننده قلمداد کرد.
در این مطلب، به این رفتارها و الگوهای قابل سنجش fingerprint، می گوییم.</p><p><a href=https://github.com/net4people/bbs/issues/47>در چین fingerprint سه دستگاه مختلف سانسور در مقاله ای مرتبط با DNS،</a> به ثبت رسیده است.
با کمک این مقاله و مقاله های مشابه، می توانیم در تمام کشورهایی که تجهیزات مدیریت، نظارت و سانسور حکومت چین در آنها نصب شده است، سانسورها در شبکه را از طریق یافتن چنین fingerprint هایی، شناسایی کنیم.</p><p>برای ساده سازی فقط یک مورد از fingerprint ها را در ادامه توضیح می دهیم و اگر نیاز بود، به مرور این بخش بروزرسانی خواهد شد.</p><h3 id=شناسایی-از-طریق-ipid>شناسایی از طریق IP.ID
<a class=anchor href=#%d8%b4%d9%86%d8%a7%d8%b3%d8%a7%db%8c%db%8c-%d8%a7%d8%b2-%d8%b7%d8%b1%db%8c%d9%82-ipid>#</a></h3><p>برای شناسایی دستی از طریق <code>IP.ID</code>، نیاز به نصب
<a href=https://www.wireshark.org/>Wireshark</a> دارید.
آموزش wireshark در اینترنت بسیار وجود دارد، در نتیجه در ادامه در نظر میگیریم که شما اطلاعات اولیه در مورد انتخاب شبکه و شروع capture کردن را دارید.
و به طریق زیر می توانید <code>IP.ID</code> را به لیست ستون های wireshark اضافه کنید تا راحت تر بتوانید کار شناسایی را انجام دهید:</p><div dir=ltr><p><img src=/images/docs/measure-internet-censorship/Application/find-l7-middleboxes/wireshark-set-ip-id-as-column.png alt=imagename></p></div><p>در ابتدا،‌ طبق مقاله، DNS را بررسی می کنیم.</p><div dir=ltr><p><img src=/images/docs/measure-internet-censorship/Application/find-l7-middleboxes/dns-middlebox-fingerprint.png alt=imagename></p></div><p>به دلیل مجاز بودن درخواست اول، در پاسخ ما IP ی درست دریافت کردیم و مقدار <code>IP.ID</code> نیز random است.
اما در درخواست دوم، یک سایت مسدود شده را تست کردیم و در پاسخ، IP های سیستم فیلترینگ جمهوری اسلامی را دریافت کردیم.
مقدار <code>IP.ID</code> (ستون Identification) در اینجا تکرار <code>IP.ID</code> ی packet ای است که از کلاینت فرستاده است.
این یعنی، طبق مقاله، سیستم سانسور در بعضی موارد، مقادیر را فقط انعکاس می دهد.</p><p>حال، به جای DNS درخواست های HTTP را تست می کنیم.
جایی که به جای UDP از TCP استفاده می کنیم اما همچنان می توانیم محتوایی مربوط به سیستم سانسور جمهوری اسلامی را دریافت کنیم.
(در صورت ای که در شبکه
<a href=https://datatracker.ietf.org/doc/html/rfc3135>PEP</a> یا cache proxy پیاده سازی نشده باشد.)</p><div dir=ltr><p><img src=/images/docs/measure-internet-censorship/Application/find-l7-middleboxes/dns-middlebox-fingerprint.png alt=imagename></p></div><p>در این مورد، ما امنیت بخش درخواست DNS را افزایش دادیم و در نتیجه، «شخص ناشناس» نمی تواند پاسخ DNS را دستکاری کند اما همچنان HTTP آسیب پذیر است.
پاسخ درست دریافت شده و مقدار <code>IP.ID</code> نیز منعکس نشده.</p><p>به همین صورت، یک آدرس مسدود شده تست می کنیم:</p><div dir=ltr><p><img src=/images/docs/measure-internet-censorship/Application/find-l7-middleboxes/http-middlebox-fingerprint-reddit-blocked.png alt=imagename></p></div><p>اما در درخواست یک سایت مسدود شده، که در پاسخ دریافتی، محتوای مربوط به سیستم سانسور جمهوری اسلامی در آن قرار دارد، می بینیم که مقدار <code>IP.ID</code> در پاسخ و در RST، انعکاسی از frame قبلی از درخواست کاربر است.
و تمام packet های ارسالی بعدی، بدون پاسخ می مانند.
که این یعنی وارد سیاهچاله شده اند.</p><p>اگر درخواست را به این صورت تکرار کنیم، که از سرور <code>example.com</code> استفاده شود و اما مقدار Host برابر با reddit باشد، باز هم چنین رفتاری را مشاهده خواهیم کرد.</p><div dir=ltr><p><img src=/images/docs/measure-internet-censorship/Application/find-l7-middleboxes/http-middlebox-fingerprint-reddit-example-dot-com-ip-blocked.png alt=imagename></p></div><p>با این موارد، می توان مطمئن شد که رفتار سیستم سانسور نسبت به تمام پروتکل ها یکسان است.</p><p>در HTTPS معمولا روش هایی مثل null routing و RST injection شناخته شده است.
اما روش های دیگری نیز وجود دارند.
در ادامه روشی را توضیح می دهیم که چند سالی است که توسط جمهوری اسلامی به سایت های زیادی اعمال می شود.</p><p>به عنوان مثال سایت <code>stackexchange.com</code> سالهاست که با این روش عموما ناشناخته مسدود شده است:</p><div dir=ltr><p><a href="https://explorer.ooni.org/chart/mat?probe_cc=IR&test_name=web_connectivity&domain=stackexchange.com&since=2019-08-01&until=2020-05-01&axis_x=measurement_start_day"><img src=/images/docs/measure-internet-censorship/Application/find-l7-middleboxes/ooni-stackexchange-dot-com-blocked-2019-2020.png alt=imagename></a></p><p><a href="https://explorer.ooni.org/chart/mat?probe_cc=IR&test_name=web_connectivity&domain=stackexchange.com&since=2021-06-27&until=2022-06-27&axis_x=measurement_start_day"><img src=/images/docs/measure-internet-censorship/Application/find-l7-middleboxes/ooni-stackexchange-dot-com-blocked-2021-2022.png alt=imagename></a></p></div><p>در این نوع سانسور، شما در DNS مشکلی نمی بینید:</p><div dir=ltr><p><img src=/images/docs/measure-internet-censorship/Application/find-l7-middleboxes/dns-stackexchange-dot-com.png alt=imagename></p></div><p>خود آدرس هم مشکلی ندارد:</p><div dir=ltr><p><img src=/images/docs/measure-internet-censorship/Application/find-l7-middleboxes/https-stackexchange-dot-com-with-example-dot-com-ip.png alt=imagename></p></div><p>(این تست با IP ی سایت <code>example.com</code> است اما از <code>stackexchange.com</code> در SNI استفاده می شود.
توضیحات بیشتر در مورد این تکنیک را در بخش «
<a href=/fa/docs/measure-internet-censorship/Application/>بررسی سانسور در ارتباط با سرور در لایه ی کاربرد</a>» می توانید بخوانید.)</p><p>اما درخواست مستقیم با خطا مواجه می شود:</p><div dir=ltr><p><img src=/images/docs/measure-internet-censorship/Application/find-l7-middleboxes/https-middlebox-fingerprint-stackexchange-dot-com.png alt=imagename></p></div><p>در اینجا می بینیم که به ظاهر یک packet به با مشخصه ی <code>PSH,ACK</code> از سرور ارسال شده اما اگر به مقدار <code>IP.ID</code> دقت کنیم، همانند سانسورهای قبلی، انعکاسی از <code>IP.ID</code> ی packet ارسالی از سمت کلاینت است.
همچنین بعد از آن هیچ پاسخی دریافتی نمی شود.
در حقیقت وارد سیاهچاله می شود.</p><p>در نتیجه، با توجه به به مقاله ای که در ابتدا به آن اشاره شد و این توضیحات گام به گام، این packet از سمت سیستم سانسور جمهوری اسلامی ارسال شده است، نه سرور.
و این fingerprint ای از تجهیزات نظارت و سانسور چین است.</p><p>اگر برعکس دو تست قبلی، از IP ی <code>stackexchange.com</code> استفاده کنیم و مقدار SNI را <code>example.com</code> قرار دهیم، باز هم این خطا را مشاهده خواهیم کرد:</p><div dir=ltr><p><img src=/images/docs/measure-internet-censorship/Application/find-l7-middleboxes/https-middlebox-fingerprint-example-dot-com-with-stackexchange-dot-com-ip.png alt=imagename></p></div><p>می توان نتیجه گرفت که در این نوع سانسور،‌ خود IP مورد هدف قرار می گیرد، و تعداد وبسایت ها و سرویس های بسیار بیشتری تحت تاثیر این نوع سانسور قرار خواهند گرفت.</p><p>اما در این نوع بخصوص از سانسور، سیاهچاله هدف اصلی نیست و سیستم سانسور جمهوری اسلامی در تلاش است تا کاربران را در استفاده از سرویس های خارجی، در مدت طولانی معطل کند:</p><div dir=ltr><p><img src=/images/docs/measure-internet-censorship/Application/find-l7-middleboxes/https-middlebox-fingerprints-ajax-aspnetcdn-dot-com.png alt=imagename></p></div><p>در این تصویر با توجه به مقادیر <code>IP.ID</code> می بینید که سیستم سانسور packet های سمت کلاینت و سرور را در میانه ی یک stream/session مسدود یا drop می کند و خودش با کلاینت شروع به ارتباط می کند.</p><p>به دلیل اینکه:</p><ul><li>کلاینت در انتظار دریافت دیتا از سرور است؛</li><li>معمولا
<a href=https://github.com/ooni/probe/issues/1609>timeout خاصی در نرم افزار های کلاینت برای قطع ارتباط در زمان read bytes وجود ندارد</a>، تا در شرایط سرعت پایین هم نرم افزار به کارکرد خودش ادامه دهد؛</li><li>وجود پاسخ هایی جعلی ACK از سمت سیستم سانسور برای فعال نگه داشتن اتصال ای که هیچ داده ای رد و بدل نمی شود و جلوگیری از بسته شدنش اش توسط سیستم عاملِ کلاینت،</li></ul><p>ارتباط تا مدت طولانی و نامشخصی ادامه پیدا خواهد کرد.</p><p>در بعضی موارد نیز، بعد از چند ثانیه یا دقیقه ارتباط مسدود می شود.
به عنوان مثال، در اینجا SSH بعد از 33 ثانیه مسدود و وارد سیاهچاله شد:</p><div dir=ltr><p><img src=/images/docs/measure-internet-censorship/Application/find-l7-middleboxes/ssh-middlebox-fingerprint-start.png alt=imagename></p><p><img src=/images/docs/measure-internet-censorship/Application/find-l7-middleboxes/ssh-middlebox-fingerprint-blocking-delay.png alt=imagename></p></div><p>مقدار <code>IP.ID</code> در ردیف های 316 و 317 که از سمت سرور ارسال شده اند (source port: 22)، برابر با مقدار <code>IP.ID</code> ای است در ردیف 314 قرار دارد و از سمت کلاینت ارسال شده است.
(source port: 47696)
درنتیجه این دو packet از سمت سیستم سانسور ارسال شده اند، نه سرور.</p><h3 id=انجام-application-traceroute>انجام application traceroute
<a class=anchor href=#%d8%a7%d9%86%d8%ac%d8%a7%d9%85-application-traceroute>#</a></h3><p>همانطور که در ابتدا اشاره شد، شناسایی و یافتن منشا سانسورهایی که در لایه ی کاربرد انجام می شوند،‌ از طریق ابزار های trace route سنتی و ping ممکن نیست.
هرچند، داشتن داده هایی بیشتر از مسیر شبکه، بسیار کمک کننده است.</p><p>یک روش از شناسایی، در بخش «
<a href=/fa/docs/measure-internet-censorship/DNS/find-DNS-hijacker/>یافتن دستگاه دستکاری کننده ی DNS</a>»‌ توضیح داده شد.
جایی که از یک packet درست و کامل DNS استفاده می شود با query های مختلف.</p><p>اما با توجه به وسعت زیادی پروتکل ها، رمزنگاری ها و تکنیک ها، ساختن هر packet از طریق یک نرم افزار، امکان پذیر نیست.
حتی در TLS به دلیل مسدود سازی ها از طریق
<a href=https://engineering.salesforce.com/tls-fingerprinting-with-ja3-and-ja3s-247362855967>TLS fingerprint</a>، ساخت یک packet ثابت راهکار خوبی برای شناسایی سانسور در لایه ی کاربرد نیست.</p><p>برای حل این موضوع،‌ در TraceVis این امکان اضافه شد تا کاربران بتوانند packet های مورد نظر خودشان را به این ابزار بدهند و در صورت نیاز، TCP handshake نیز انجام دهند.
و یا در صورت نیاز، تنها packet ای را که در حال retransmit است را با همان مشخصات اصلی trace route کنند.
مانند مورد SSH که بعد از 33 ثانیه ارتباط قطع شده بود.</p><p>در بخش های مختلف و به ترتیب، روش ها و نکات استفاده، توضیح داده خواهد شد:</p><ul><li>نصب و اجرا</li><li>کپی کردن یک packet از Wireshark</li><li>استفاده از file های config</li><li>انجام trace route بعد از مشاهده ی وارد سیاه چاله شدن</li><li>تکنیک paris traceroute</li><li>توضیحات بیشتر</li></ul><p>شناسایی پاسخ middlebox از طریق fingerprint آنها به صورت اتوماتیک توسط TraceVis در زمان packet injection گسترده:</p><div dir=ltr><p><img src=/images/docs/measure-internet-censorship/Application/find-l7-middleboxes/tracevis-blocked-server-packet-injection.png alt=imagename></p></div><p>(علامت ستاره به معنای پاسخ از سیستم سانسور است و دایره های خاکستری به معنای عدم پاسخ در آن hop)</p><p>در زمان رفع شدن سانسور:</p><div dir=ltr><p><img src=/images/docs/measure-internet-censorship/Application/find-l7-middleboxes/tracevis-unblocked-server-no-packet-injection.png alt=imagename></p></div><h4 id=نصب-و-اجرا>نصب و اجرا
<a class=anchor href=#%d9%86%d8%b5%d8%a8-%d9%88-%d8%a7%d8%ac%d8%b1%d8%a7>#</a></h4><p>این ابزار در سیستم عامل های Linux, Windows, macOS تست شده.
برای اجرا،‌ نیاز به داشتن
<a href=https://www.python.org/>Python</a> نسخه ی 3 دارید.
و در ویندوز، نیاز به نصب npcap که با نصب
<a href=https://www.wireshark.org/>Wireshark</a>، به صورت اتوماتیک نصب خواهد شد.</p><p>در لینوکس، نسخه کرنل قبل از 5 نیاز به نصب iptables نیز دارید.</p><p>بعد از دانلود و یا clone کردن با git، قبل از استفاده باید از نیازمندی های برنامه، که scapy، pyvis و requests هستند را نصب کنید:</p><div dir=ltr><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>python3 -m pip install -r requirements.txt
</span></span></code></pre></div></div><p>یا با docker:</p><div dir=ltr><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>docker pull ghcr.io/wikicensorship/tracevis
</span></span></code></pre></div></div><p>برای تست عملکرد درست برنامه، میتوانید تست عادی DNS را اجرا کنید:</p><div dir=ltr><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>python3 ./tracevis.py --dns
</span></span></code></pre></div></div><p>یا با docker:</p><div dir=ltr><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>docker run ghcr.io/wikicensorship/tracevis --dns
</span></span></code></pre></div></div><p>اگر خطایی مشاهده نکردید و نتیجه درست بود، یعنی کار را به درستی انجام دادید و این ابزار آماده ی استفاده است.</p><h4 id=دریافت-یک-packet-از-wireshark-و-استفاده-در-tracevis>دریافت یک packet از Wireshark و استفاده در TraceVis
<a class=anchor href=#%d8%af%d8%b1%db%8c%d8%a7%d9%81%d8%aa-%db%8c%da%a9-packet-%d8%a7%d8%b2-wireshark-%d9%88-%d8%a7%d8%b3%d8%aa%d9%81%d8%a7%d8%af%d9%87-%d8%af%d8%b1-tracevis>#</a></h4><p>در بخش «
<a href=/fa/docs/measure-internet-censorship/DNS/find-DNS-hijacker/>یافتن دستگاه دستکاری کننده ی DNS</a>»‌ توضیح داده شد که چطور در tcpdump مقدار hexdump از packet ها بعد از لایه ی IP را مشاهده کنید و به TraceVis بدهید.
اما با Wireshark به دلیل گرافیکی بودن ابزار، دریافت packet درست، راحت تر است.</p><p>در آخرین نسخه از TraceVis این امکان فراهم شده است که هم packet کامل که از لایه ی Ethernet شروع شده است دریافت کند، و هم از لایه ی IP.
بنابراین، یک packet به صورت زیر می تواند دریافت شود:</p><div dir=ltr><p><img src=/images/docs/measure-internet-censorship/Application/find-l7-middleboxes/wireshark-copy-hexdump.png alt=imagename></p></div><p>(هر دو مورد Hex+ASCII Dump و Hex Dump برای TraceVis یکسان هستند)</p><p>در TraceVis دستور را به صورت زیر اجرا می کنید:</p><div dir=ltr><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>python3 ./tracevis.py -p 
</span></span></code></pre></div></div><p>و مقدار کپی شده را paste می کنید:</p><div dir=ltr><p><img src=/images/docs/measure-internet-censorship/Application/find-l7-middleboxes/tracevis-paste-packet.png alt=imagename></p></div><p>بعد از یک Enter مشخصات packet برای شما نمایش داده خواهد شد:</p><div dir=ltr><p><img src=/images/docs/measure-internet-censorship/Application/find-l7-middleboxes/tracevis-paste-packet.png alt=imagename></p></div><p>اگر packet ای با flag های PSH,ACK را به TraceVis بدهید، مانند Client Hello و یا DNS over TCP، از شما سوال خواهد شد که آیا مایل به انجام TCP handshake قبل از ارسال این packet مورد نظر، هستید یا خیر.
(نکته: در DNS over TCP نیاز به TCP handshake نیست اما همچنان PSH,ACK است.
در نتیجه سوال می شود)</p><p>دلیل انجام این کار این است که اگر در شبکه، تجهیزاتی مانند
<a href=https://datatracker.ietf.org/doc/html/rfc3135>PEP</a> وجود داشته باشد، از عبور packet هایی مانند Client Hello بدون TCP session فعال، جلوگیری خواهد کرد و نتیجه ای اشتباه خواهید داد.
بنابراین، در TraceVis امکان انجام درست TCP handshake و بعد ارسال packet درخواستی کاربر با استفاده از TCP session به وجود آمده، فراهم شده است.
(در برنامه، ساز و کاری برای مشاهده ی hop های بعد از PEP هم در نظر گرفته شده است)</p><div dir=ltr><p><img src=/images/docs/measure-internet-censorship/Application/find-l7-middleboxes/tracevis-paste-packet.png alt=imagename></p></div><p>اگر در لینوکس در حال تست هستید، به شما اطلاع داده می شود که نیاز دارید تا این rule برای iptables را اضافه کنید، تا از ارسال packet های RST توسط سیستم عامل کلاینت جلوگیری شود.
این کار فقط در kernel های <strong>قبل</strong> از 5 مورد نیاز است.
و می توانید از TraceVis بخواهید که به صورت اتوماتیک این کار را برای شما انجام دهد.
(اضافه و حذف بعد از پایان)
اگر در حال تست در سیستم عامل دیگری هستید، سوال بعدی پرسیده می شود برای اضافه کردن packet دوم:</p><div dir=ltr><p><img src=/images/docs/measure-internet-censorship/Application/find-l7-middleboxes/tracevis-second-packet.png alt=imagename></p></div><p>که دقیقا مراحل مثل قبل است.
و بعد از اتمام تست شروع می شود.</p><h4 id=استفاده-از-file-های-config>استفاده از file های config
<a class=anchor href=#%d8%a7%d8%b3%d8%aa%d9%81%d8%a7%d8%af%d9%87-%d8%a7%d8%b2-file-%d9%87%d8%a7%db%8c-config>#</a></h4><p>بعد از انجام هر تست توسط TraceVis یک فایل config نیز برای اجرای دوباره ی همان دستور بدون نیاز به طی کردن مراحل قبلی ساخته می شود.
چند فایل نمونه هم در پوشه ی samples اضافه شده است.
به عنوان مثال اگر میخواهید تست NTP انجام دهید:</p><div dir=ltr><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>python3 ./tracevis.py --config ./samples/ntp.conf
</span></span></code></pre></div></div><p>و اگر قصد تغییر مقصد پیشفرض را دارید، کافی است تا آدرس را اضافه کنید:</p><div dir=ltr><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>python3 ./tracevis.py --config ./samples/ntp.conf -i “1.2.3.4”
</span></span></code></pre></div></div><p>توجه داشته باشید که امکان تغییر مواردی مانند SNI از طریق خط فرمان فعلا میسر نیست، در نتیجه، اگر قصد تست وبسایت جدیدی را دارید، باید یک packet جدید برایش بسازید.
چرا که، به عنوان مثال، فایل <code>clienthello.conf</code> در samples مقدار SNI اش آدرس <code>instagram.com</code> هست.
و همچنین ممکن استTLS fingerprint قدیمی Chrome باشد و سانسور بر مبنای TLS fingerprint وجود داشته باشد.</p><h4 id=انجام-trace-route-بعد-از-مشاهده-ی-وارد-سیاهچاله-شدن>انجام trace route بعد از مشاهده ی وارد سیاهچاله شدن
<a class=anchor href=#%d8%a7%d9%86%d8%ac%d8%a7%d9%85-trace-route-%d8%a8%d8%b9%d8%af-%d8%a7%d8%b2-%d9%85%d8%b4%d8%a7%d9%87%d8%af%d9%87-%db%8c-%d9%88%d8%a7%d8%b1%d8%af-%d8%b3%db%8c%d8%a7%d9%87%da%86%d8%a7%d9%84%d9%87-%d8%b4%d8%af%d9%86>#</a></h4><p>در بخش قبلی در مورد SSH دیده بودید که بعد از 33 ثانیه، ارتباط وارد سیاهچاله شده بود، و در مواردی این حالت به صورت موقت وارد سیاهچاله می شد و دوباره ارتباط برقرار می شد.
در این شرایط امکان شناسایی منشاء این مشکل از طریق شیوه های قبلی وجود ندارد، چرا که فعلا امکان پیاده سازی هر پروتکل به صورت مجزا ممکن نیست.
برای شناسایی منشاء این مشکل در این حالت، فقط کافی است که یکی از packet هایی که در حال retransmission هستند را کپی کنیم:</p><div dir=ltr><p><img src=/images/docs/measure-internet-censorship/Application/find-l7-middleboxes/wireshark-copy-retransmission-packet.png alt=imagename></p></div><p>و به صورت زیر به برنامه بدهیم:</p><div dir=ltr><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>python3 ./tracevis.py --rexmit
</span></span></code></pre></div></div><p>بعد از زدن کلید Enter، تست شروع می شود و سه بار تکرار می شود.
در این حالت، TraceVis مقادیر five-tuple را حفظ می کند و همگام با افزایش TTL از 1، مقدار <code>IP.ID</code> این packet را نیز یک مرتبه افزایش می دهد.
این حالت شبیه به یک retransmission واقعی است، اما در عین حال، می توانیم متوجه شویم که از چه بخشی از مسیر ارتباط null route می شود.</p><h4 id=تکنیک-paris>تکنیک paris
<a class=anchor href=#%d8%aa%da%a9%d9%86%db%8c%da%a9-paris>#</a></h4><p>تکنیک Paris یا
<a href=https://paris-traceroute.net/about/>Paris Traceroute</a> به روشی که گفته می شود که در آن five-tuple هر packet در هر مرحله حفظ می شود تا هر بار در شبکه، از یک مسیر یکسان عبور کند.</p><div dir=ltr><p><img src=/images/docs/measure-internet-censorship/Application/find-l7-middleboxes/paris-traceroute-technique.png alt=imagename></p></div><p>این روش، از دیدن loop اشتباه در شبکه جلوگیری می کند.</p><div dir=ltr><p><img src=/images/docs/measure-internet-censorship/Application/find-l7-middleboxes/tracevis-standard-traceroute-problem.png alt=imagename></p></div><p>که در صورت استفاده از تکنیک paris، به این صورت خواهد بود:</p><div dir=ltr><p><img src=/images/docs/measure-internet-censorship/Application/find-l7-middleboxes/tracevis-paris-traceroute.png alt=imagename></p></div><p>در اینجا مشاهده می کنید که که در ابتدای مسیر، تعداد hop های مسیر سمت چپ کمتر از مسیر سمت راست است.
این حالت باعث شده بود که در حالت غیر paris،‌ تعداد زیادی حلقه مشاهده کنیم.</p><p>هرچند همانطور که در بخش «
<a href=/fa/docs/measure-internet-censorship/Network/>بررسی سانسور در ارتباط با سرور در لایه‌ی شبکه و انتقال</a>» گفته شد، ممکن است حتی با تکنیک paris هم این حلقه ها را مشاهده کنید.
در این صورت، می تواند نشانی از walled garden باشد برای ایزوله کردن ارتباط داخل و خارج شبکه.</p><div dir=ltr><p><img src=/images/docs/measure-internet-censorship/Application/find-l7-middleboxes/tracevis-loop-in-paris-technique.png alt=imagename></p></div><p>نکته ی مهم:‌ اما اگر از این روش برای حالتی استفاده می کنید که از قبل نیاز به TCP handshake دارد،‌ ممکن است نتیجه ای که مشاهده می کنید با خطا مواجه شود.
به دلیل اینکه:
ابتدا با سرور اتصال برقرار می شود و TCP session فعال به وجود می آید
بعضی سرور ها در مدت کمی بعد از ایجاد TCP session، و در صورت دیافت نکردن packet، اقدام به بستن ارتباط با استفاده از packet های FIN یا RST می کنند.
که این خود نکاتی دارد:
سیستم سانسور نیز ممکن است اقدام به ارسال این packet ها کند که در بعضی شرایط میتوان از طریق fingerprint سیستم سانسور تفاوت را تشخیص داد.
اگر در شبکه PEP وجود داشته باشد و بعضی middlebox ها، بعد از مشاهده ی این packet ها از ادامه ی ارتباط جلوگیری می کنند.
و باعث اشتباه در نتیجه خواهند شد، در نتیجه نمیتوان وجود آنها را نادیده گرفت.</p><p>به دلیل اینکه در این حالت، مقدار five-tuple یکسان هستند، و همچنین اعمال سانسور، سیاهچاله یا packet injection، ممکن است با تاخیر همراه شود، نمیتوان با سرعت زیادی و یا به صورت همزمان با TTL های مختلف تست انجام داد.</p><p>هرچند در تلاش هستیم که هر روز بهینه سازی هایی انجام دهیم و راهکار های زیادی می توان در نظر گرفت.</p><p>یکی از موارد خوب در استفاده از این روش، در حالتی که سرور سریعا ارتباط را قطع نکند، تشخیص انسداد متناوب است.
در این حالت، چند اتصال مجاز به عبور و چند اتصال مسدود می شوند.
به طور مثال، آدرس مربوط به بخش دایرکت اینستاگرام را به صورت زیر تست می کنیم:</p><div dir=ltr><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>python3 ./tracevis.py -p -m <span style=color:#ae81ff>30</span> --paris -r <span style=color:#ae81ff>9</span>
</span></span></code></pre></div></div><p>حداکثر تعداد 30 hop و تعداد تکرار 9 بار.
و packet مورد نظر داده می شود و درخواست TCP handshake هم می شود.
به همراه تکنیک paris، یعنی 9 مورد five-tuple مختلف.</p><div dir=ltr><p><img src=/images/docs/measure-internet-censorship/Application/find-l7-middleboxes/tracevis-paris-instagram-intermittent-blcoking-tci.png alt=imagename></p></div><p>در این تصویر تست فقط جریان های 1،3،7،9 با موفقیت به مقصد رسیدند.
دیگر موارد در داخل قبل از خروج از کشور و با چقدر تلاش، از عبور آنها جلوگیری شد.</p><p>به صورت مشابه میتوان تست DNS نیز برای شناسایی موقعیت سیستم سانسور انجام داد:</p><div dir=ltr><p><img src=/images/docs/measure-internet-censorship/Application/find-l7-middleboxes/tracevis-dns-example-dot-com-and-twitter-tci.png alt=imagename></p></div><p>دقیقا در موقعیتی که پاسخی در جریان های مربوط به اینستاگرام دریافت نشد،</p><div dir=ltr><p><img src=/images/docs/measure-internet-censorship/Application/find-l7-middleboxes/tracevis-instagram-blocking-zoom-middlebox-location.png alt=imagename></p></div><p>به آدرس های سانسور شده در DNS واکنش نشان داده می شود:</p><div dir=ltr><p><img src=/images/docs/measure-internet-censorship/Application/find-l7-middleboxes/tracevis-dns-zoom-middlebox-location.png alt=imagename></p></div><p>( مکان اصلی این سیستم سانسور: بعد از 10.21.249.201)</p><h4 id=توضیحات-بیشتر>توضیحات بیشتر
<a class=anchor href=#%d8%aa%d9%88%d8%b6%db%8c%d8%ad%d8%a7%d8%aa-%d8%a8%db%8c%d8%b4%d8%aa%d8%b1>#</a></h4><p>روش های و امکانات زیادی در TraceVis قرار داده شده است که میتوانید از آنها بهره ببرید.
مانند اضافه کردن پیشوند برای فایل های نتایج.
اضافه کردن یادداشت به هر نتیجه ی مستقل با یک packet.
و یا دیدن نتایج به صورت جدولی در یک فایل CSV.</p><div dir=ltr><p><img src=/images/docs/measure-internet-censorship/Application/find-l7-middleboxes/tracevis-help.png alt=imagename></p></div><p>هم اکنون این ابزار در حال استفاده و قابلیت استفاده ی گسترده را دارد.
اما فعلا بهتر است توسط افرادی که از شبکه اطلاع دارند و این مطلب را خوانده اند تحلیل و بررسی شود.</p><p>در تلاشیم تا قبل از نسخه ی اول، بهینه سازی های زیادی انجام دهیم و امکانات بیشتری اضافه کنیم.</p><p>و همچنین تشخیص روش های سانسور را برای کاربران و خودمان راحت تر کنیم.</p><p>به عنوان مثال در شرایطی که حتی در TCP handshake هم سیستم سانسور خود را جای سرور قرار می دهد.</p><div dir=ltr><p><img src=/images/docs/measure-internet-censorship/Application/find-l7-middleboxes/wireshark-cdn-comodo-middlebox-from-start-to-end.png alt=imagename></p></div><p>در اینجا می بینید که حتی <code>IP.ID</code> در <code>SYN,ACK</code> هم انعکاسی از <code>IP.ID</code> ی <code>SYN</code> است.</p><p>سیستم سانسور در اینجا ارتباط را با <code>SYN,ACK</code> شروع کرده، با <code>PSH,ACK</code> پاسخ داده*، و با <code>FIN,ACK</code> ارتباط را پایان داده.</p><p>[*] در اینجا، <code>PSH,ACK</code> دارای هیچ دیتایی نیست، اما مواردی با مقدار های زیر هم مشاهده شده است:</p><div dir=ltr><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span><span style=color:#e6db74>&#34;\x30\x32\x30\x30\x30\x30&#34;</span>
</span></span><span style=display:flex><span><span style=color:#e6db74>&#34;\x6e\x96\x3f\xa9\xf8\xdd&#34;</span> 
</span></span><span style=display:flex><span><span style=color:#e6db74>&#34;\xfe\xb3\x01\xa0\xbf\xcb&#34;</span>
</span></span></code></pre></div></div><p>بعد از به اصطلاح رفع شدن مشکل، اثری از پاسخ ها از سمت سیستم سانسور نیست اما کیفیت ارتباط به شدت پایین است:</p><div dir=ltr><p><img src=/images/docs/measure-internet-censorship/Application/find-l7-middleboxes/wireshark-cdn-comodo-semi-fixed.png alt=imagename></p></div><h2 id=شناسایی-موقعیت-سیستم-های-سانسور-دیگر-در-یک-مسیر-یکسان>شناسایی موقعیت سیستم های سانسور دیگر در یک مسیر یکسان
<a class=anchor href=#%d8%b4%d9%86%d8%a7%d8%b3%d8%a7%db%8c%db%8c-%d9%85%d9%88%d9%82%d8%b9%db%8c%d8%aa-%d8%b3%db%8c%d8%b3%d8%aa%d9%85-%d9%87%d8%a7%db%8c-%d8%b3%d8%a7%d9%86%d8%b3%d9%88%d8%b1-%d8%af%db%8c%da%af%d8%b1-%d8%af%d8%b1-%db%8c%da%a9-%d9%85%d8%b3%db%8c%d8%b1-%db%8c%da%a9%d8%b3%d8%a7%d9%86>#</a></h2><p>در تکنیک paris موردی از سانسور متناوب اینستاگرام توضیح داده شده است.
در ادامه دو مورد از سانسور دیگر توضیح می دهیم:</p><ul><li>سیستم سانسور TLS fingerprint</li><li>سانسورهای امنیتی</li></ul><h3 id=سیستم-سانسور-tls-fingerprint>سیستم سانسور TLS fingerprint
<a class=anchor href=#%d8%b3%db%8c%d8%b3%d8%aa%d9%85-%d8%b3%d8%a7%d9%86%d8%b3%d9%88%d8%b1-tls-fingerprint>#</a></h3><p>در این نوع سانسور،‌ شما ممکن است با یک برنامه یا مرورگر به وبسایتی دسترسی داشته باشید اما با یک مرورگر دیگر این امکان وجود نداشته باشد.</p><p>به طور مثال، سایت آمازون با کروم:</p><div dir=ltr><p><img src=/images/docs/measure-internet-censorship/Application/find-l7-middleboxes/chrome-tls-fingerprint-blocking-aws-except-china.png alt=imagename></p></div><p>(آمازونِ چین جزو لیست سانسور نبوده)</p><p>اما با فایرفاکس مشکلی وجود نداشته:</p><div dir=ltr><p><img src=/images/docs/measure-internet-censorship/Application/find-l7-middleboxes/firefox-tls-fingerprint-accessibility.png alt=imagename></p></div><p>از طریق TraceVis یک تست اجرا می کنیم.</p><p>یک Client Hello از Chrome را که آدرس <code>example.com</code> در SNI وجود دارد استفاده می کنیم.
اما به مقصد یکی از IP های AWS که توسط سایت آمازون استفاده می شود:</p><div dir=ltr><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>python3 ./tracevis.py -p --annot1 <span style=color:#e6db74>&#34;example.com CH chrome&#34;</span> --paris -i <span style=color:#e6db74>&#34;13.226.135.75&#34;</span>
</span></span></code></pre></div></div><p>به همین صورت یک تست اما Client Hello از Firefox اجرا می کنیم.
و در انتها دو نتیجه را با هم ترکیب می کنیم.
به این صورت:</p><div dir=ltr><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>Python3 ./tracevis.py  -f “./path/to/file-firefox.json” -f “./path/to/file-chrome.json”
</span></span></code></pre></div></div><p>نتیجه به این صورت خواهد بود:</p><div dir=ltr><p><img src=/images/docs/measure-internet-censorship/Application/find-l7-middleboxes/tracevis-firefox-chrome-tls-fingerpring-blocking-aws.png alt=imagename></p></div><p>رنگ صورتی مربوط به chrome است و رنگ فیروزه ای مربوط به Firefox.</p><div dir=ltr><p><img src=/images/docs/measure-internet-censorship/Application/find-l7-middleboxes/tracevis-firefox-chrome-tls-fingerprint-blocking-zoom-middlebox-location.png alt=imagename></p></div><p>همانطور که می بینید،‌تمام درخواست ها بعد از <code>10.202.6.90</code> وارد سیاهچاله شده اند.</p><p>به دلیل Hijack شدن تمام درخواست های DNS، (همانطور که در بخش «
<a href=/fa/docs/measure-internet-censorship/DNS/find-DNS-hijacker/>یافتن دستگاه دستکاری کننده ی DNS</a>» توضیح داده شد)، اگر تست DNS به سمت همین IP انجام دهیم:</p><div dir=ltr><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>python ./tracevis.py --dns -i <span style=color:#e6db74>&#34;13.226.135.75&#34;</span> -m <span style=color:#ae81ff>30</span> --paris
</span></span></code></pre></div></div><p>که در اینجا به صورت اتوماتیک دو درخواست DNS برای آدرس های <code>example.com</code> که سانسور نیست، و <code>twitter.com</code> که سانسور است انجام می شود.</p><div dir=ltr><p><img src=/images/docs/measure-internet-censorship/Application/find-l7-middleboxes/tracevis-dns-aws-example-dot-com-and-twitter.png alt=imagename></p></div><p>رنگ صورتی آدرس <code>twitter.com</code> و رنگ فیروزه ای آدرس <code>example.com</code> است.</p><div dir=ltr><p><img src=/images/docs/measure-internet-censorship/Application/find-l7-middleboxes/tracevis-dns-aws-example-dot-com-and-twitter-zoom-middlebox-location.png alt=imagename></p></div><p>تمام درخواست های مربوط به <code>twitter.com</code> بعد از <code>10.21.249.201</code> مسدود می شوند.
(برخلاف مورد قبلی که بعد از <code>10.202.6.90</code> بود)</p><p>سانسور در SNI نیز انجام می شود، چه تفاوتی ممکن است بین مسدود سازی از طریق TLS fingerprint و SNI وجود داشته باشد؟‌ برای پاسخ به این سوال، یک تست مربوط به SNI نیز به سمت همین مقصد مورد نظر، انجام می دهیم:</p><div dir=ltr><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>python ./tracevis.py -p --annot1 <span style=color:#e6db74>&#34;twitter.com chrome&#34;</span> -i <span style=color:#e6db74>&#34;13.226.135.75&#34;</span>
</span></span></code></pre></div></div><p>این بار از Client Hello ی کروم استفاده می کنیم اما به جاز آدرس مجاز <code>example.com</code> از آدرس <code>twitter.com</code> استفاده می کنیم.</p><div dir=ltr><p><img src=/images/docs/measure-internet-censorship/Application/find-l7-middleboxes/tracevis-sni-blocking-twitter-with-aws-ip.png alt=imagename></p></div><p>با زوم بیشتر:</p><div dir=ltr><p><img src=/images/docs/measure-internet-censorship/Application/find-l7-middleboxes/tracevis-sni-blocking-twitter-with-aws-ip-zoom.png alt=imagename></p></div><p>همانطور که می بینید، برخلاف مورد اول، قبل از اینکه به <code>10.202.6.90</code> برسد درخواست های بعدی وارد سیاهچاله شده است.</p><p>این نشان می دهد که که حتی
<a href=https://geneva.cs.umd.edu/papers/foci21.pdf>ساختار شبکه هم شبیه به چین</a> ساخته شده است.</p><h3 id=سانسورهای-امنیتی>سانسورهای امنیتی
<a class=anchor href=#%d8%b3%d8%a7%d9%86%d8%b3%d9%88%d8%b1%d9%87%d8%a7%db%8c-%d8%a7%d9%85%d9%86%db%8c%d8%aa%db%8c>#</a></h3><p>از «سانسورهای امنیتی»، در اینجا برای توضیح مواردی استفاده می کنیم که توسط سیستم های سانسور معمول انجام نمی شوند و معمولا شیوه ی سانسور آنها نیز متفاوت است و ممکن است فقط در یک شبکه و حتی یک middlebox مشاهده شوند (در صورت میزبانی شدن آن سرویس در داخل کشور).
به عنوان مثال سانسور کلاب‌هاوس در همراه اول، در همان ابتدای شبکه انجام می شود:</p><div dir=ltr><p><img src=/images/docs/measure-internet-censorship/Application/find-l7-middleboxes/tracevis-clubhouse-client-hello-blocking-mci.png alt=imagename></p></div><p>و حتی به سیستم سانسور معمول شبکه و یا سیستم های سانسور بعدی در زیرساخت نمی رسد.
موقعیت های حدودی سیستم اصلی سانسور در همراه اول:</p><div dir=ltr><p><img src=/images/docs/measure-internet-censorship/Application/find-l7-middleboxes/tracevis-dns-main-middlbox-location-mci.png alt=imagename></p></div><p>در «سانسورهای امنیتی»، شما فقط زمانی سانسور را مشاهده می کنید که مقدار SNI و IP ی درستی انتخاب کنید.
اگر در SNI از <code>example.com</code> استفاده کنید و یا از یک IP ی متفاوت، سانسور را مشاهده نخواهید کرد.
اما از طریق TraceVis می توانید متوجه شوید که در چه موقعیت ای از شبکه این سانسور انجام می شود.</p></article><footer class=book-footer><div class="flex flex-wrap justify-between"><div><a class="flex align-center" href=https://github.com/wikicensorship/wikicensorship.github.io/commit/058868dbf673588bffcb47453d9916809b022cb4 title='آخرین بار ویرایش شده توسط xhdix | June 29, 2022' target=_blank rel=noopener><img src=/svg/calendar.svg class=book-icon alt=Calendar>
<span>June 29, 2022</span></a></div><div><a class="flex align-center" href=https://github.com/wikicensorship/wikicensorship.github.io/edit/main/content/docs/measure-internet-censorship/Application/find-l7-middleboxes/_index.md target=_blank rel=noopener><img src=/svg/edit.svg class=book-icon alt=Edit>
<span>این صفحه را ویرایش کنید</span></a></div></div><script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script><script>var BookGitHubUser="wikicensorship",BookGitHubRepo="wikicensorship.github.io"</script><script>var callbackName="ghButtonCallback"+Math.floor(Math.random()*1e4),script,button=document.querySelector(".btn-with-count");window[callbackName]=function(e){var t=addCommas(e.data.stargazers_count);button.querySelector(".social-count").textContent=t};function addCommas(e){return new String(e).replace(/(\d)(?=(\d{3})+$)/g,"$1,")}script=document.createElement("script"),script.src="https://api.github.com/repos/"+BookGitHubUser+"/"+BookGitHubRepo+"?callback="+callbackName,document.head.appendChild(script);const themeColor=document.querySelector('meta[name="theme-color"]'),colorScheme=document.querySelector('meta[name="color-scheme"]'),body=document.body,prefersDarkScheme=window.matchMedia("(prefers-color-scheme: dark)"),currentTheme=localStorage.getItem("theme");currentTheme=="dark"?(prefersDarkScheme.matches||document.documentElement.classList.toggle("dark"),themeColor.content=getComputedStyle(body).color,colorScheme.content="dark"):currentTheme=="light"&&(prefersDarkScheme.matches&&document.documentElement.classList.toggle("light"),themeColor.content=getComputedStyle(body).color,colorScheme.content="light");function toggletheme(){if(prefersDarkScheme.matches){document.documentElement.classList.toggle("light"),themeColor.content=getComputedStyle(body).color,colorScheme.content=colorScheme.content=="dark"?"light":"dark";var e=document.documentElement.classList.contains("light")?"light":"dark"}else document.documentElement.classList.toggle("dark"),themeColor.content=getComputedStyle(body).color,colorScheme.content=colorScheme.content=="dark"?"light":"dark",e=document.documentElement.classList.contains("dark")?"dark":"light";localStorage.setItem("theme",e)}</script></footer><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><div class=book-toc-content><nav id=TableOfContents><ul><li><a href=#یافتن-سیستم-سانسور-کننده-در-لایه-ی-کاربرد>یافتن سیستم سانسور کننده در لایه ی کاربرد</a><ul><li><a href=#یافتن-fingerprint-سیستم-سانسور-در-پاسخ-ها>یافتن fingerprint سیستم سانسور در پاسخ ها</a><ul><li><a href=#شناسایی-از-طریق-ipid>شناسایی از طریق IP.ID</a></li><li><a href=#انجام-application-traceroute>انجام application traceroute</a></li></ul></li><li><a href=#شناسایی-موقعیت-سیستم-های-سانسور-دیگر-در-یک-مسیر-یکسان>شناسایی موقعیت سیستم های سانسور دیگر در یک مسیر یکسان</a><ul><li><a href=#سیستم-سانسور-tls-fingerprint>سیستم سانسور TLS fingerprint</a></li><li><a href=#سانسورهای-امنیتی>سانسورهای امنیتی</a></li></ul></li></ul></li></ul></nav></div></aside></main></body></html>